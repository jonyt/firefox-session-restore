<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.png">

    <title>Firefox Sessionstore Restorer</title>

    <!-- Bootstrap core CSS -->
    <link href="stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->
    
    <style>
        body {
          padding-top: 50px;
        }
        #submit {
          margin-top: 10px;
        }
        #spinner {
          display: none;
        }
        #error {
          visibility: hidden;
        }
    </style>
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Firefox Sessionstore Restorer</a>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="starter-template">
        <h1>Firefox Sessionstore Restorer</h1>
        <p class="lead">Just paste the contents of your sessionstore file here and submit. Watch the magic happen!</p>
        <div class="row">
          <div class="col-md-6">
            <div id="error" class="alert alert-danger"></div>
            <form id="json-form" role="form">
              <textarea id="json-string" class="form-control" rows="20"></textarea>
              <button id="submit" type="submit" class="btn btn-primary btn-xlarge">Submit</button>
              <img id="spinner" src="images/ajax-loader.gif" alt="Loading...">
            </form>
          </div>
          <div id="results" class="col-md-6">
          </div>          
        </div>
        <div class="row">
          <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fff-sessionstore-restore.herokuapp.com%2F&amp;width=450&amp;height=35&amp;colorscheme=light&amp;layout=standard&amp;action=like&amp;show_faces=false&amp;send=true&amp;appId=203941499773181" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:35px;" allowTransparency="true"></iframe>
              <iframe allowtransparency="true" frameborder="0" scrolling="no" src="https://platform.twitter.com/widgets/tweet_button.html&url=http%3A%2F%2Fff-sessionstore-restore.herokuapp.com%2F" style="width:130px; height:20px;"></iframe>
        </div>
      </div>

    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="javascripts/jquery-1.7.1.min.js"></script>
    <script src="javascripts/bootstrap.min.js"></script>
    <script>
      $(document).ready(function(){
        $('#json-form').submit(function(){
          $('#spinner').show();
          $('#error').css({visibility: 'hidden'});
          $('#results').empty();
          
          $.ajax({
            url: "/parse",
            data: {json: $('#json-string').val()},
            dataType: 'json',
            type: "POST",
            error: function(jqXHR, textStatus, errorThrown){
              var errorText = (jqXHR.responseText && jqXHR.responseText == 'No JSON provided' ? 'Please fill in the form' : 'An error occured, please reload the page');
              $('#error').css({visibility: 'visible'});
              $('#error').text(errorText);
            },
            success: function(data){
              console.log(typeof data);
              
              $(data).each(function(index, url){
                $('#results').append( $('<p />').append( $('<a />', {href: url, target: "_blank"}).text(url) ) );  
              });
            },
            complete: function(){
              $('#spinner').hide();
            }
          });
          
          return false;
        });  
      });
    </script>
  </body>
</html>
